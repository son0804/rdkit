#summary How to build the PostgreSQL cartridge
#labels cartridge

*NOTE* These instructions are valid for versions of the RDKit newer than Q3 2011 (v2011_09_1). Build instructions for older versions can be found [BuildingTheCartridge_old here].

= Requirements =

Compatibility: PostgreSQL 8.4+. Tested through PostgreSQL 9.1.

It should be possible to build the cartridge using either a version of PostgreSQL built from source or a package from your linux distribution (be sure to include the -devel package).


= Compilation and Testing = 

The Makefile assumes that the RDKit is installed in $RDBASE and that $BOOSTHOME points to where boost is installed.
You will need $RDBASE/lib in your $LD_LIBRARY_PATH

Go to the cartridge directory: 

{{{ 
cd $RDBASE/Code/PgSQL/rdkit
make && make install && make installcheck 
}}}


The last step will take a few minutes. The last step will probably fail on older debian-based linux distributions such as Ubuntu because of a [http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=554166 bug in their postgresql packages]. To run the tests there you will need to install postgresql from source.

*Note:* With PostgreSQL v9.0 the `props` test may fail. This is only due to a difference in output formatting and is not an indication of a real problem.

= Postmaster configuration (pre v9.0) =

Add the following line in your postgresql.conf:

{{{
shared_preload_libraries = 'rdkit'
}}}

This way configuration variables provided by the cartridge will be available since server startup and you could avoid errors like this:

{{{
show rdkit.tanimoto_threshold;

ERROR:  unrecognized configuration parameter "rdkit.tanimoto_threshold"

********** Error **********

ERROR: unrecognized configuration parameter "rdkit.tanimoto_threshold"
SQL state: 42704
}}}


= Adding the cartridge to a database =

== For versions of PostgreSQL < 9.1 ==

Install rdkit cartridge into the database DB: 
   `psql DB < $RDBASE/Code/PgSQL/rdkit.sql`
or:
   `psql DB < /usr/share/postgresql/8.4/contrib/rdkit.sql`
the actual path in the second form depends on where postgresql is installed.

Uninstall rdkit cartridge from database DB:
   `psql DB < $RDBASE/Code/PgSQL/uninstall_rdkit.sql`
or:
   `psql DB < /usr/share/postgresql/8.4/contrib/uninstall_rdkit.sql`

== For versions of PostgreSQL >= 9.1 ==

To install rdkit cartridge into the database DB: 
   `psql -c 'CREATE EXTENSION rdkit' DB`

Uninstall cartridge from database DB:
   `psql -c 'DROP EXTENSION rdkit CASCADE' DB`


= Example installations =

== Ubuntu 11.10 ==

Installed packages:
  * RDKit from svn
  * boost from libboost-all-dev package
  * postgresql packages (some of these may be redundant):
    * postgresql
    * postgresql-client
    * postgresql-client-common
    * postgresql-common
    * postgresql-contrib
    * postgresql-doc
    * postgresql-server-dev-all
  * development packages:
    * flex
    * bison
    * g++

To make postgresql useable, you have to create a database user for yourself:
{{{
% sudo su postgres  
postgres@ubuntu:% createuser glandrum
}}}

Building the RDKit:
{{{
% cd $RDBASE
% mkdir build
% cd build
% cmake ..
% make -j4 install
}}}

Building and installing the cartridge:
{{{
% cd $RDBASE/Code/PgSQL/rdkit
% make
% sudo make install
% make installcheck
}}}

Another quick check to make sure it really works:
{{{
% createdb gregdb
% psql gregdb
psql (9.1.3)
Type "help" for help.

gregdb=# create extension "rdkit";
CREATE EXTENSION

gregdb=# show rdkit.tanimoto_threshold;
 rdkit.tanimoto_threshold 
--------------------------
 0.5
(1 row)

gregdb=# select 'c1ccccc1O'::mol;
    mol    
-----------
 Oc1ccccc1
(1 row)
}}}

----
[http://www.postgresql.org http://www.postgresql.org/files/community/propaganda/95x51_4.gif]
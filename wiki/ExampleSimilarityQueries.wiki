#summary Some example queries for doing similarity searching.
#labels cartridge,Tutorial

= Introduction =

These queries are using the database created following the instructions on the DatabaseCreation page.


= Similarity search using Morgan fingerprints =

Tanimoto similarity using the current similarity cutoff:
{{{
chembl=# select count(*) from fps where morganbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1',2) % morganbv;
 count 
-------
     6
(1 row)
}}}
The `%` operator calculates the Tanimoto similarity between two fingerprints. You can calculate the Dice similarity using the `#` operator:
{{{
chembl=# select count(*) from fps where morganbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1',2) # morganbv;
 count 
-------
    65
(1 row)
}}}

   _An Aside:_ the "2" which is included as the second argument in all the calls to `morganbv_fp` above is the radius to be used in the Morgan fingerprint calculation. It's important that the value provided in the query match that used to generate the database. 
   In a future version of the cartridge, this argument will have a default value so that it doesn't need to be provided every time.

Including the similarity values in the search results :
{{{
chembl=# select regno,tanimoto_sml(morganbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1',2), morganbv) sml from fps
chembl-# where morganbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1',2) % morganbv order by sml desc;
 regno  |        sml        
--------+-------------------
 359520 |                 1
 359882 | 0.902777777777778
 358683 | 0.597560975609756
 358280 | 0.511363636363636
 358281 |               0.5
 358763 |               0.5
(6 rows)
}}}
Including SMILES by joining in the molecule table:
{{{
chembl=# select regno,tanimoto_sml(morganbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1',2), morganbv) sml,m from fps
chembl-# join mols using (regno) where 
chembl-# morganbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1',2) % morganbv order by sml desc;
 regno  |        sml        |                                     m                                      
--------+-------------------+----------------------------------------------------------------------------
 359520 |                 1 | N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1
 359882 | 0.902777777777778 | N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(F)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1
 358683 | 0.597560975609756 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(CC3CC3)CC2)c1
 358280 | 0.511363636363636 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(Cc3ccccc3)CC2)c1
 358281 |               0.5 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(CCCCCO)CC2)c1
 358763 |               0.5 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCNCC2)c1
(6 rows)
}}}

To retrieve more values, change the similarity threshold:
{{{
chembl=# show rdkit.tanimoto_threshold;
 rdkit.tanimoto_threshold 
--------------------------
 0.5
(1 row)

chembl=# set rdkit.tanimoto_threshold=0.4;
SET
chembl=# select count(*) from fps where morganbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1',2) % morganbv;
 count 
-------
    28
(1 row)
}}}

= Similarity search using other fingerprints =

Tanimoto similarity between topological torsion fingerprints using the current similarity cutoff:
{{{
chembl=# select regno,tanimoto_sml(torsionbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1'), torsionbv) sml,m from fps
chembl-# join mols using (regno) where 
chembl-# torsionbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1') % torsionbv order by sml desc;

 regno  |        sml        |                                        m                                         
--------+-------------------+----------------------------------------------------------------------------------
 359520 |                 1 | N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1
 359882 | 0.918367346938776 | N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(F)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1
 358683 | 0.711538461538462 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(CC3CC3)CC2)c1
 358764 | 0.641509433962264chembl= | CN1CCC(C2c3ccc(-c4cccc(C#N)c4)cc3CCN2CC(=O)Nc2cc(Cl)cc(Cl)c2)CC1
 358743 | 0.641509433962264 | CC(C)N1CCC(C2c3ccc(-c4cccc(C#N)c4)cc3CCN2CC(=O)Nc2cc(Cl)cc(Cl)c2)CC1
 358763 | 0.622641509433962 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCNCC2)c1
 358280 | 0.618181818181818 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(Cc3ccccc3)CC2)c1
 358518 | 0.618181818181818 | CS(=O)(=O)N1CCC(C2c3ccc(-c4cccc(C#N)c4)cc3CCN2CC(=O)Nc2cc(Cl)cc(Cl)c2)CC1
 358714 | 0.618181818181818 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCC3)CC2)c1
 358492 | 0.618181818181818 | CC(=O)N1CCC(C2c3ccc(-c4cccc(C#N)c4)cc3CCN2CC(Nc2cc(Cl)cc(Cl)c2)=O)CC1
 358281 | 0.618181818181818 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(CCCCCO)CC2)c1
 358599 | 0.607142857142857 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCC3)CC2)c1
 358283 | 0.607142857142857 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCOCC3)CC2)c1
 358282 | 0.607142857142857 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCCCC3)CC2)c1
 358462 | 0.607142857142857 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCCC3)CC2)c1
 358284 | 0.576271186440678 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCSC3)CC2)c1
 358652 | 0.576271186440678 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(Cc3ccoc3)CC2)c1
 358600 | 0.571428571428571 | N#Cc1ccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCC3)CC2)cc1
 358682 | 0.557377049180328 | COc1ccccc1CN1CCC(C2N(CC(=O)Nc3cc(Cl)cc(Cl)c3)CCc3c2ccc(-c2cccc(C#N)c2)c3)CC1
 358268 | 0.543859649122807 | O=Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCC3)CC2)c1
 358636 | 0.543859649122807 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3cccc(Cl)c3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358793 | 0.543859649122807 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3ccccc3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358274 | 0.542372881355932 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3cccc(-c4ncc[nH]4)c3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358602 |  0.53448275862069 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3cccc(F)c3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358403 | 0.525423728813559 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3cccc(OC(F)(F)F)c3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358269 | 0.525423728813559 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3c(Cl)ccc(Cl)c3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358402 | 0.525423728813559 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3cccc(C(F)(F)F)c3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358401 | 0.525423728813559 | COc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCC3)CC2)c1
 358701 | 0.524590163934426 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3ccc[nH]3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358477 | 0.517241379310345 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3ccncc3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358270 | 0.516129032258065 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3cccc4cccnc34)cc2CC1)Nc1cc(Cl)cc(Cl)c1
 358505 | 0.508196721311475 | O=C(CN1C(C2CCN(C3CCCC3)CC2)c2ccc(-c3cccnc3)cc2CC1)Nc1cc(Cl)cc(Cl)c1
(32 rows)
}}}

Tanimoto similarity between atom-pair fingerprints using the current similarity cutoff:
{{{
chembl=# select regno,tanimoto_sml(atompairbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1'), pairbv) sml,m from fps
chembl-# join mols using (regno) where
chembl-# atompairbv_fp('N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1') % pairbv order by sml desc;
 regno  |        sml        |                                        m                                         
--------+-------------------+----------------------------------------------------------------------------------
 359520 |                 1 | N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(Cl)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1
 359882 | 0.884892086330935 | N#Cc1cccc(-c2ccc3c(c2)CCN(Cc2nc4cc(Cl)c(F)cc4[nH]2)C3C2CCN(CC3CC3)CC2)c1
 358683 | 0.733333333333333 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(CC3CC3)CC2)c1
 358714 | 0.676375404530744 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCC3)CC2)c1
 358599 | 0.676375404530744 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCC3)CC2)c1
 358282 | 0.661392405063291 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCCCC3)CC2)c1
 358462 | 0.661392405063291 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCCC3)CC2)c1
  ...

 358268 | 0.507788161993769 | O=Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C3C2CCN(C3CCCC3)CC2)c1
 358139 | 0.507462686567164 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cc(Cl)cc(Cl)c2)C32CCN(CC3CC3)CC2)c1
 358532 | 0.507418397626113 | N#Cc1cccc(-c2ccc3c(c2)CCN(CC(=O)Nc2cccc(Cl)c2)C32CCN(CC3CC3)CC2)c1
(34 rows)
}}}

----
[http://www.postgresql.org http://www.postgresql.org/files/community/propaganda/95x51_4.gif]
#summary Loading the full ChEMBL database into PostgreSQL
#labels cartridge,Notes

  _*Note*_ : This example uses cartridge functionality, specifically   `mol_from_ctab`, that is not present in releases prior to 2011 Q3. Until that release happens, you will need to work with the svn version of the RDKit to follow these instructions.


= Introduction =

= Getting the raw data into PostgreSQL =

Start by downloading the MySQL dump of ChEMBL_10: (ftp://ftp.ebi.ac.uk/pub/databases/chembl/ChEMBLdb/releases/chembl_10/chembl_10_mysql.tar.gz)
and creating a MySQL database from it.

Convert that to a PostgreSQL database using [https://bitbucket.org/akuchling/mysql2pgsql mysql2pgsql] :
{{{
./my2pg.py -v --mysql-user=username --mysql-password=password \
 --pg-user=username --pg-password=password \
 --drop-tables localhost chembl_10 localhost chembl_10
}}}
In order to process the data tables in ChEMBL I needed to make a few changes to `my2pg.py`. The modified version is here:
http://pastebin.com/0hsZ7LxX

Thanks to Adrian Schreyer for the pointer to my2pg.


= Creating the RDKit tables =

Because there are problems with the SMILES that are present in the ChEMBL data, I build the RDKit molecules from the CTABS:
{{{
chembl_10=# create schema rdk;
chembl_10=# select molregno,mol_from_ctab(molfile::cstring) m into rdk.mols from compound_structures where is_valid_ctab(molfile::cstring) ;
SELECT 998577
Time: 1134900.554 ms
chembl_10=# create index molidx on rdk.mols using gist(m);
CREATE INDEX
Time: 1400330.072 ms
chembl_10=# select molregno,torsionbv_fp(m) as torsionbv,morganbv_fp(m,2) as mfp2,featmorganbv_fp(m,2) as ffp2 into rdk.fps from rdk.mols;
SELECT 998577
Time: 734113.058 ms
chembl_10=# create index fps_ttbv_idx on rdk.fps using gist(torsionbv);
CREATE INDEX
Time: 121170.006 ms
chembl_10=# create index fps_mfp2_idx on rdk.fps using gist(mfp2);
CREATE INDEX
Time: 88036.863 ms
chembl_10=# create index fps_ffp2_idx on rdk.fps using gist(ffp2);
CREATE INDEX
Time: 87593.358 ms
chembl_10=# alter table rdk.mols add primary key (molregno);
NOTICE:  ALTER TABLE / ADD PRIMARY KEY will create implicit index "mols_pkey" for table "mols"
ALTER TABLE
Time: 832.436 ms
chembl_10=# alter table rdk.fps add primary key (molregno);
NOTICE:  ALTER TABLE / ADD PRIMARY KEY will create implicit index "fps_pkey" for table "fps"
ALTER TABLE
Time: 704.792 ms
}}}


#summary Clustering molecules with the RDKit
#labels Tutorial

= Using Butina clustering =

For large sets of molecules (more than 1000-2000), it's most efficient to use the Butina clustering algorithm.

{{{
def ClusterFps(fps,cutoff=0.2):
    from rdkit import DataStructs
    from rdkit.ML.Cluster import Butina

    # first generate the distance matrix:
    dists = []
    nfps = len(fps)
    for i in range(1,nfps):
        sims = DataStructs.BulkTanimotoSimilarity(fps[i],fps[:i])
        dists.extend([1-x for x in sims])

    # now cluster the data:
    cs = Butina.ClusterData(dists,nfps,cutoff,isDistData=True)
    return cs
}}}

The return value is a tuple of clusters, where each cluster is a tuple of ids.

Example usage:
{{{
from rdkit import Chem
from rdkit.Chem import AllChem
import gzip
ms = [x for x in Chem.ForwardSDMolSupplier(gzip.open('zdd.sdf.gz')) if x is not None]
fps = [AllChem.GetMorganFingerprintAsBitVect(x,3,1024) for x in ms]
clusters=ClusterFps(fps,cutoff=0.3)
}}}

The variable `clusters` contains the results:
{{{
>>> print clusters[200]
(8080, 1490, 4821, 7845)
}}}
That cluster contains 4 points, the centroid is point 8080.
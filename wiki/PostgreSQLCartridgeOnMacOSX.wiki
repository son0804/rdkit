#labels osx10.7,postgreSQL,RDKit
A recipe on installing the PostgreSQL cartridge on Max OS X 10.7 

= Introduction =

This recipe assumes that you have installed RDKit with Eddie Cao's Homebrew formula. If not, check out the following page for instructions: http://edc.github.com/homebrew-rdkit/


= Details =

==1) Installation of PostgreSQL==

Download `postgresql-9.1.3.tar.gz` from http://www.postgresql.org/ftp/source/v9.1.3/ and uncompressed the contents into `/usr/local/src`.
Install according the documentation provided by PostgreSQL:

{{{
> cd /usr/local/src/postgresql-9.1.3/
> mkdir build
> cd build
> ../configure
> make world
> make check
> sudo make install-world
}}}

Update your `~/.bash_profile` to include the following:

{{{
export PATH="$PATH:/usr/local/pgsql/bin"
export DYLD_LIBRARY_PATH="$DYLD_LIBRARY_PATH:/usr/local/pgsql/lib"
export PGDATA="/usr/local/pgsql/data"
}}}


==2) Install the cartridge==

Start by downloading the source code of RDKit (version 2012.03.1) and install it under `/usr/local/src`.
Creating a symbolic link from the source code into `/usr/local/Cellar`:

{{{
> cd /usr/local/Cellar/rdkit/2012.03.1
> ln -s /usr/local/src/RDKit_2012_03_1/Code
}}}

Make sure that the following environment variables are defined (I'm not sure all of these are required):

{{{
export RDBASE="/usr/local/Cellar/rdkit/2012.03.1"
export DYLD_LIBRARY_PATH="$DYLD_LIBRARY_PATH:$RDBASE/lib"
export PYTHONPATH="$PYTHONPATH:/usr/local/lib/python2.7/site-packages"
}}}

Chdir into `/usr/local/src/RDKit_2012_03_1/Code/PgSQL/rdkit` and remove the static linking directive from the `Makefile` by replacing the 3rd line (`STATIC_LINK=1`) into `STATIC_LINK=0`. Then start the installation as usual:

{{{
> make
> sudo make install
}}}


==3) Install the extension==

Assuming you have launched `psql` as a superuser , one can install the extension from within `psql`:

{{{
=> create extension "rdkit";
CREATE EXTENSION

=> show rdkit.tanimoto_threshold;
 rdkit.tanimoto_threshold 
--------------------------
 0.5
(1 row)

=> select 'c1ccccc1O'::mol;
    mol    
-----------
 Oc1ccccc1
(1 row)
}}}

By adding the `shared_preload_libraries = 'rdkit'` line to your `/usr/local/pgsql/data/postgresql.conf` file, configuration variables provided by the cartridge will be available since server startup and you could avoid errors like this:

{{{
=> show rdkit.tanimoto_threshold;
ERROR:  unrecognized configuration parameter "rdkit.tanimoto_threshold"
}}}